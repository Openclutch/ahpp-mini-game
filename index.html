<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AHPP Underground Garage Tycoon</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at top, #1a1740 0%, #050510 70%);
      font-family: 'Courier New', monospace;
      color: #d8f6ff;
      letter-spacing: 0.03em;
    }
    #wrap { display:flex; flex-direction:column; height:100%; }
    header {
      background: linear-gradient(135deg, #141631, #0b0d1d 60%, #1b2640 100%);
      color:#f2fbff;
      padding:10px 14px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      box-shadow:0 0 24px rgba(0,255,255,0.18);
      border-bottom:1px solid rgba(0,255,255,0.2);
    }
    header .pill {
      background: rgba(15, 30, 60, 0.8);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,255,255,0.3);
      box-shadow:0 0 10px rgba(0,255,255,0.25);
    }
    header .hint {
      opacity:.9;
      font-weight:400;
      color:#9fdcff;
      flex-basis:100%;
      margin-top:4px;
    }
    header button {
      border:1px solid rgba(0,255,255,0.35);
      background: rgba(8,18,40,0.85);
      color:#aff6ff;
      border-radius:999px;
      padding:6px 14px;
      cursor:pointer;
      text-transform:uppercase;
      font-weight:700;
      box-shadow:0 0 12px rgba(0,255,255,0.25);
    }
    header button:hover { color:#fff; border-color:rgba(255,45,117,0.6); box-shadow:0 0 16px rgba(255,45,117,0.35); }
    header .savebar { display:flex; gap:8px; align-items:center; margin-left:auto; }
    header .savebar input[type=file]{ display:none; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    #gameArea {
      position:relative;
      flex:1;
      background:#050510;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:clamp(12px, 3vh, 36px) 0 clamp(48px, 12vh, 140px);
    }
    #gameArea::before {
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top, rgba(31,24,76,0.65) 0%, rgba(5,5,16,0.9) 60%, rgba(2,2,8,1) 100%);
      pointer-events:none;
      z-index:0;
    }
    canvas {
      position:relative;
      z-index:1;
      width:min(1280px, 100%);
      height:auto;
      display:block;
      image-rendering: pixelated;
      background:#04040a;
      box-shadow:0 26px 52px rgba(0,0,0,0.45);
      border-radius:12px;
    }

    .window {
      position:absolute;
      top:clamp(18px, 5vh, 52px);
      left:50%;
      z-index:2;
      transform:translateX(-50%);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:clamp(18px, 5vw, 60px);
      width:min(96vw, 1080px);
      flex-wrap:wrap;
    }
    .panel {
      background: rgba(8, 16, 36, 0.85);
      border:1px solid rgba(0,255,255,0.25);
      border-radius:10px;
      padding:12px;
      width:clamp(180px, 22vw, 220px);
      display:flex;
      flex-direction:column;
      max-height:min(78vh, 620px);
      box-shadow:0 0 18px rgba(0,255,255,0.2);
      pointer-events:auto;
      transition:opacity .22s ease, transform .22s ease;
    }
    .panel.panel-hidden {
      opacity:0;
      pointer-events:none;
      transform:translateY(-18px);
    }
    .panel.panel-hidden:not(.events-panel) {
      display:none;
    }
    .panel h3 { margin:0 0 10px 0; font-size:17px; color:#63e7ff; text-transform:uppercase; letter-spacing:0.12em; }
    .panel .row { display:flex; align-items:center; justify-content:space-between; gap:8px; margin:8px 0; }
    .panel button {
      padding:6px 10px;
      border-radius:6px;
      border:1px solid rgba(99,231,255,0.5);
      background: rgba(5, 12, 30, 0.85);
      color:#8fe8ff;
      cursor:pointer;
      box-shadow:0 0 10px rgba(99,231,255,0.28);
    }
    .panel button:hover { color:#fff; border-color:rgba(255,82,148,0.6); box-shadow:0 0 14px rgba(255,82,148,0.4); }
    .mod-list { flex:1 1 auto; max-height:min(60vh, 540px); overflow-y:auto; font-size:13px; }
    .panel-note { font-size:12px; opacity:0.75; margin-top:8px; }

    #events {
      position:relative;
      top:auto;
      right:auto;
      width:clamp(220px, 26vw, 320px);
      max-height:min(60vh, 480px);
      background:rgba(8,16,36,0.9);
      padding:12px 14px;
      transition:opacity .18s ease-out, transform .18s ease-out, visibility .18s ease-out;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transform:translateY(-12px) scale(0.97);
    }
    #events.open {
      opacity:1;
      visibility:visible;
      pointer-events:auto;
      transform:none;
    }
    #events h3 { margin:0 0 8px 0; font-size:17px; color:#63e7ff; text-transform:uppercase; letter-spacing:0.12em; }
    #feed { max-height:min(34vh, 320px); overflow:auto; font-size:13px; line-height:1.3; }

    @media (max-width: 980px) {
      .panel {
        width:clamp(160px, 32vw, 200px);
        padding:10px;
      }
      #events {
        width:clamp(200px, 46vw, 260px);
        padding:10px 12px;
      }
      .panel h3 {
        font-size:15px;
      }
      .panel .panel-note { font-size:11px; }
      #feed { max-height:min(36vh, 260px); }
    }

    @media (max-height: 720px) {
      .panel {
        max-height:min(68vh, 520px);
      }
      #events {
        max-height:min(52vh, 360px);
      }
    }
    .evt { padding:4px 0; border-bottom:1px dashed rgba(99,231,255,0.3); }

    #tooltip { position:absolute; pointer-events:none; background:rgba(5,12,30,0.9); color:#aff6ff; padding:6px 8px; border-radius:4px; font-size:12px; transform:translate(-50%, -140%); opacity:0; transition:opacity .08s; white-space:nowrap; border:1px solid rgba(99,231,255,0.5); box-shadow:0 0 8px rgba(99,231,255,0.4); }

    footer {
      background: linear-gradient(135deg, rgba(8,12,32,0.95), rgba(8,18,44,0.95));
      color:#9fdcff;
      padding:10px 14px;
      font-size:14px;
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      border-top:1px solid rgba(0,255,255,0.2);
    }
    footer code { background:#071026; color:#8fe8ff; padding:2px 6px; border-radius:6px; }

    .touch-controls { position:absolute; bottom:clamp(20px, 8vh, 96px); display:flex; align-items:center; gap:24px; z-index:10; }
    .touch-controls button { touch-action:none; user-select:none; font-size:14px; font-weight:700; display:flex; align-items:center; justify-content:center; padding:0; color:#9fdcff; background:rgba(8,18,40,0.85); border:1px solid rgba(99,231,255,0.4); border-radius:12px; width:84px; height:56px; box-shadow:0 0 12px rgba(99,231,255,0.3); }
    .touch-controls button:active { box-shadow:0 0 16px rgba(255,45,117,0.4); border-color:rgba(255,45,117,0.6); color:#fff; }
    #p1Controls { flex-direction:row; align-items:center; left:16px; right:auto; }
    .dpad { position:relative; width:120px; height:120px; border-radius:50%; background:rgba(8,18,40,0.9); border:1px solid rgba(99,231,255,0.35); box-shadow:inset 0 0 18px rgba(0,255,255,0.25); display:flex; align-items:center; justify-content:center; touch-action:none; user-select:none; }
    .dpad::before, .dpad::after { content:""; position:absolute; background:rgba(99,231,255,0.15); }
    .dpad::before { width:70%; height:2px; }
    .dpad::after { width:2px; height:70%; }
    .dpad .stick { width:60px; height:60px; border-radius:50%; background:#0d162e; border:1px solid rgba(99,231,255,0.4); box-shadow:0 3px 10px rgba(0,0,0,0.4); transition:transform .05s ease-out; pointer-events:none; }
    .dpad.active .stick { box-shadow:0 4px 12px rgba(255,45,117,0.4); }
  </style>
</head>
<body>
<div id="wrap">
  <header>
    <div class="pill" id="p1money">Credits: $0</div>
    <div class="pill" id="p1hud">Parts: — | Builds: —</div>
    <button id="toggleEvents" title="Toggle Street Feed (H)">Street Feed</button>
    <div class="savebar">
      <button id="btnSave" title="Save to browser (Autosaves too)">Save</button>
      <button id="btnLoad" title="Load from browser">Load</button>
      <button id="btnExport" title="Download save file">Export</button>
      <button id="btnImport" title="Import save file">Import</button>
      <label for="fileImport" class="sr-only">Import save file</label>
      <input id="fileImport" type="file" accept="application/json" title="Import save file" />
    </div>
    <div class="hint">The Garage persists even when you log off. Overheated bays must be cleared for $250. Fill the spotlight in the plaza to recruit rare crew.</div>
  </header>
  <div id="gameArea">
    <canvas id="game" width="1280" height="720"></canvas>

    <div class="window" id="vendors">
      <div class="panel" id="shopPanel">
        <h3>Parts Vendor</h3>
        <div id="modList" class="mod-list"></div>
        <div class="panel-note" id="partsHelp">Stand at the vendor & press <b>Action</b> (<code>E</code>) to toggle this UI.</div>
      </div>
      <div id="events" class="panel events-panel">
        <h3>Street Feed</h3>
        <div id="feed"></div>
      </div>
      <div class="panel" id="sellPanel">
        <h3>Race Terminal</h3>
        <div id="sellInfo" style="font-size:13px;">Park at the terminal & press Action to bank every finished build in your stash.</div>
      </div>
    </div>

    <div id="tooltip"></div>

    <div class="touch-controls" id="p1Controls">
      <div class="dpad" data-up="KeyW" data-down="KeyS" data-left="KeyA" data-right="KeyD">
        <div class="stick"></div>
      </div>
      <div class="actions">
        <button data-key="KeyQ">Swap</button>
        <button data-key="KeyE">Wrench</button>
      </div>
    </div>
  </div>
  <footer>
    <div>
      <b>Controls:</b> Use <code>WASD</code> to walk, <code>1–0</code> to select part, <code>Q</code> to swap parts, and <code>E</code> to work a bay. Press <code>H</code> to toggle the Street Feed.
    </div>
    <div>
      Install mods in your own bays. If a build overheats, clear it for $250. Hype the plaza spotlight to recruit legendary crew with powerful perks.
    </div>
  </footer>
</div>

<script src="game.js"></script>
</body>
</html>
