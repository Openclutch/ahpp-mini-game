<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>AHPP Underground Garage Tycoon</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at top, #8c0027 0%, #2b0f1a 70%);
      font-family: 'Courier New', monospace;
      color: #fbe6c0;
      letter-spacing: 0.03em;
      touch-action: manipulation;
    }
    #wrap { display:flex; flex-direction:column; height:100%; }
    header {
      background: linear-gradient(145deg, rgba(56,18,28,0.95), rgba(163,42,38,0.78) 55%, rgba(249,148,60,0.68) 100%);
      color:#fff9f3;
      padding:14px clamp(14px, 3vw, 28px);
      font-weight:600;
      font-family:'Segoe UI', Tahoma, sans-serif;
      font-size:clamp(15px, 1.4vw, 18px);
      letter-spacing:0.01em;
      display:flex;
      align-items:center;
      gap:16px;
      flex-wrap:wrap;
      box-shadow:0 0 26px rgba(221,65,17,0.32);
      border-bottom:1px solid rgba(241,165,18,0.45);
      text-shadow:0 1px 3px rgba(22,6,13,0.55);
    }
    header .logo {
      height:clamp(38px, 7vw, 64px);
      width:auto;
      display:block;
      filter:drop-shadow(0 3px 6px rgba(10,0,0,0.5));
    }
    header .pill {
      background: rgba(16, 8, 14, 0.32);
      padding:8px 14px;
      border-radius:999px;
      border:1px solid rgba(255, 228, 179, 0.55);
      box-shadow:0 0 14px rgba(22, 8, 18, 0.45);
      color:#fff5d6;
      font-size:0.95em;
      letter-spacing:0.04em;
    }
    header .hint {
      opacity:.9;
      font-weight:400;
      color:#a1d4b1;
      flex-basis:100%;
      margin-top:6px;
      text-shadow:none;
      font-size:clamp(13px, 1.1vw, 15px);
    }
    header button {
      border:1px solid rgba(241,165,18,0.45);
      background: rgba(32, 12, 21, 0.85);
      color:#fbe6c0;
      border-radius:999px;
      padding:8px 18px;
      cursor:pointer;
      text-transform:uppercase;
      font-weight:700;
      font-size:0.85em;
      box-shadow:0 0 14px rgba(221,65,17,0.35);
    }
    header button:hover { color:#fff; border-color:rgba(241,165,18,0.75); box-shadow:0 0 16px rgba(241,165,18,0.4); background:rgba(221,65,17,0.75); }
    header .hint, header .pill { filter:none; }
    .devbar {
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      align-items:center;
      margin-left:auto;
      padding-left:12px;
      border-left:1px solid rgba(241,165,18,0.3);
    }
    .devbar button {
      border:1px dashed rgba(161,212,177,0.65);
      background:rgba(43,175,144,0.18);
      color:#a1d4b1;
      box-shadow:0 0 8px rgba(43,175,144,0.22);
    }
    .devbar button:hover {
      border-style:solid;
      color:#fff;
      background:rgba(43,175,144,0.32);
      box-shadow:0 0 12px rgba(161,212,177,0.35);
    }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    #gameArea {
      position:relative;
      flex:1;
      background:#2b0f1a;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:clamp(12px, 3vh, 36px) 0 clamp(48px, 12vh, 140px);
    }
    #gameArea::before {
      content:"";
      position:absolute;
      inset:-8% -8% -18% -8%;
      background:radial-gradient(circle at top, rgba(70,24,57,0.65) 0%, rgba(30,10,24,0.92) 55%, rgba(21,6,16,0.98) 100%);
      pointer-events:none;
      z-index:0;
    }
    canvas {
      position:relative;
      z-index:1;
      width:min(1280px, 100%);
      height:auto;
      display:block;
      image-rendering: pixelated;
      background:#360c1b;
      box-shadow:0 26px 52px rgba(0,0,0,0.45);
      border-radius:12px;
      touch-action:manipulation;
    }

    .window {
      position:absolute;
      top:clamp(18px, 5vh, 52px);
      left:50%;
      z-index:2;
      transform:translateX(-50%);
      display:flex;
      align-items:stretch;
      justify-content:space-between;
      gap:clamp(32px, 6vw, 96px);
      padding:0 clamp(26px, 6vw, 100px);
      width:min(96vw, 1240px);
      flex-wrap:wrap;
    }
    .panel {
      background: linear-gradient(160deg, rgba(71,16,32,0.9), rgba(43,15,26,0.95));
      border:1px solid rgba(241,165,18,0.35);
      border-radius:10px;
      padding:12px;
      width:clamp(200px, 24vw, 260px);
      display:flex;
      flex-direction:column;
      max-height:min(78vh, 620px);
      box-shadow:0 0 18px rgba(221,65,17,0.28);
      pointer-events:auto;
      transition:opacity .22s ease, transform .22s ease;
    }
    #shopPanel { align-self:flex-start; }
    #events {
      flex:1 1 clamp(260px, 32vw, 360px);
      margin:0 auto;
    }
    .panel.panel-hidden {
      opacity:0;
      pointer-events:none;
      transform:translateY(-18px);
    }
    .panel.panel-hidden:not(.events-panel) {
      display:none;
    }
    .panel h3 { margin:0 0 10px 0; font-size:17px; color:#f1a512; text-transform:uppercase; letter-spacing:0.12em; }
    .panel .row { display:flex; align-items:center; justify-content:space-between; gap:8px; margin:8px 0; }
    .panel button {
      padding:6px 10px;
      border-radius:6px;
      border:1px solid rgba(43,175,144,0.55);
      background: rgba(43,175,144,0.18);
      color:#a1d4b1;
      cursor:pointer;
      box-shadow:0 0 10px rgba(43,175,144,0.28);
    }
    .panel button:hover { color:#fff; border-color:rgba(241,165,18,0.7); box-shadow:0 0 14px rgba(241,165,18,0.45); background:rgba(221,65,17,0.65); }
    .mod-list { flex:1 1 auto; max-height:min(60vh, 540px); overflow-y:auto; font-size:13px; }
    .panel-note { font-size:12px; opacity:0.75; margin-top:8px; }

    #events {
      position:relative;
      top:auto;
      right:auto;
      max-height:min(60vh, 480px);
      background:rgba(71,16,32,0.92);
      padding:12px 14px;
      transition:opacity .18s ease-out, transform .18s ease-out, visibility .18s ease-out;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transform:translateY(-12px) scale(0.97);
    }
    #events.open {
      opacity:1;
      visibility:visible;
      pointer-events:auto;
      transform:none;
    }
    #events h3 { margin:0 0 8px 0; font-size:17px; color:#f1a512; text-transform:uppercase; letter-spacing:0.12em; }
    #feed { max-height:min(34vh, 320px); overflow:auto; font-size:13px; line-height:1.3; }

    @media (max-width: 980px) {
      .window {
        justify-content:center;
        padding:0 clamp(18px, 4vw, 40px);
        gap:clamp(24px, 6vw, 64px);
      }
      .panel {
        width:clamp(180px, 34vw, 220px);
        padding:10px;
      }
      #events {
        flex:1 1 clamp(220px, 58vw, 320px);
        padding:10px 12px;
      }
      .panel h3 {
        font-size:15px;
      }
      .panel .panel-note { font-size:11px; }
      #feed { max-height:min(36vh, 260px); }
    }

    @media (max-height: 720px) {
      .panel {
        max-height:min(68vh, 520px);
      }
      #events {
        max-height:min(52vh, 360px);
      }
    }
    .evt { padding:4px 0; border-bottom:1px dashed rgba(241,165,18,0.3); }

    .event-banner {
      position:fixed;
      top:16px;
      left:50%;
      transform:translate(-50%, -110%);
      background:rgba(71,16,32,0.94);
      color:#fce2b6;
      border:1px solid rgba(241,165,18,0.65);
      border-radius:999px;
      padding:12px 24px;
      box-shadow:0 10px 24px rgba(0,0,0,0.35);
      font-weight:700;
      letter-spacing:0.08em;
      line-height:1.35;
      max-width:min(90vw, 720px);
      opacity:0;
      pointer-events:none;
      transition:transform .22s ease-out, opacity .22s ease-out;
      z-index:20;
      text-align:center;
      white-space:normal;
    }

    .event-banner.show {
      opacity:1;
      transform:translate(-50%, 0);
    }
    #tooltip { position:absolute; pointer-events:none; background:rgba(71,16,32,0.92); color:#fbe6c0; padding:6px 8px; border-radius:4px; font-size:12px; transform:translate(-50%, -140%); opacity:0; transition:opacity .08s; white-space:nowrap; border:1px solid rgba(241,165,18,0.6); box-shadow:0 0 8px rgba(221,65,17,0.4); z-index:20; }

    .touch-controls { position:absolute; bottom:clamp(20px, 8vh, 96px); display:flex; align-items:center; gap:24px; z-index:10; }
    .touch-controls button { touch-action:none; user-select:none; font-size:14px; font-weight:700; display:flex; align-items:center; justify-content:center; padding:0; color:#fbe6c0; background:rgba(71,16,32,0.88); border:1px solid rgba(241,165,18,0.45); border-radius:12px; width:84px; height:56px; box-shadow:0 0 12px rgba(221,65,17,0.35); }
    .touch-controls button:active { box-shadow:0 0 16px rgba(241,165,18,0.45); border-color:rgba(241,165,18,0.7); color:#fff; }
    #p1Controls { flex-direction:row; align-items:center; left:16px; right:auto; }
    .dpad { position:relative; width:120px; height:120px; border-radius:50%; background:rgba(71,16,32,0.92); border:1px solid rgba(241,165,18,0.5); box-shadow:inset 0 0 18px rgba(221,65,17,0.35); display:flex; align-items:center; justify-content:center; touch-action:none; user-select:none; }
    .dpad::before, .dpad::after { content:""; position:absolute; background:rgba(161,212,177,0.25); }
    .dpad::before { width:70%; height:2px; }
    .dpad::after { width:2px; height:70%; }
    .dpad .stick { width:60px; height:60px; border-radius:50%; background:#dd4111; border:1px solid rgba(241,165,18,0.6); box-shadow:0 3px 10px rgba(35,8,18,0.6); transition:transform .05s ease-out; pointer-events:none; }
    .dpad.active .stick { box-shadow:0 4px 12px rgba(241,165,18,0.55); }
  </style>
</head>
<body>
<div id="wrap">
  <header>
    <img src="Lees_Garage_png.png" alt="Lee's Garage" class="logo" />
    <div class="pill" id="p1money">Credits: $0</div>
    <div class="pill" id="p1hud">Parts: — | Builds: —</div>
    <button id="toggleEvents" title="Toggle Street Feed (H)">Street Feed</button>
    <button id="btnHelp" title="Show controls guide">Help</button>
    <div class="devbar" id="devTools">
      <button id="btnDevReset" title="Clear all local progress and reload">Reset Progress</button>
      <button id="btnDevFunds" title="Grant bonus credits for testing">+10k Credits</button>
      <button id="btnDevFinish" title="Complete installs currently in progress">Finish Builds</button>
    </div>
    <div class="hint">Keep your crew sharp and the bays busy. If a tune goes bad and the engine blows, cover 150% of that upgrade's cost to get the car out. Fill the spotlight in the plaza to recruit rare crew.</div>
    <div id="eventBanner" class="event-banner" role="status" aria-live="polite" aria-hidden="true"></div>
  </header>
  <div id="gameArea">
    <canvas id="game" width="1280" height="720"></canvas>

    <div class="window" id="vendors">
      <div class="panel" id="shopPanel">
        <h3>Parts Vendor</h3>
        <div id="modList" class="mod-list"></div>
        <div class="panel-note" id="partsHelp">Stand at the vendor & press <b>Action</b> (<code>E</code>) to toggle this UI.</div>
      </div>
      <div id="events" class="panel events-panel">
        <h3>Street Feed</h3>
        <div id="feed"></div>
      </div>
    </div>

    <div id="tooltip"></div>

    <div class="touch-controls" id="p1Controls">
      <div class="dpad" data-up="KeyW" data-down="KeyS" data-left="KeyA" data-right="KeyD">
        <div class="stick"></div>
      </div>
      <div class="actions">
        <button data-key="KeyQ">Swap</button>
        <button data-key="KeyE">Wrench</button>
      </div>
    </div>
  </div>
</div>

<script src="game.js"></script>
</body>
</html>
